<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title id="name_of_stands">{{ name_of_place[1] }}</title>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load("current", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawCurrentChart);
      function drawCurrentChart() {
        var currentData = google.visualization.arrayToDataTable([
          ['Task', 'Hours per Day'],
          ['Empty',     {{ all_data[5] }} ],
          ['Is available',      {{ all_data[6] }}],
        ]);

        var currentOptions = {
          title: '{{ name_of_place[1] }} current availability',
          is3D: true,
        };

        var currentChart = new google.visualization.PieChart(document.getElementById('current_chart'));
        currentChart.draw(currentData, currentOptions);
      }

      google.charts.load("historical", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawHistoricalChart);
      <!--google.charts.load('historical2', {'packages':['bar']});-->
      google.charts.setOnLoadCallback(drawHistoricalWeekChart);


      function drawHistoricalChart() {
      var historicalData = new google.visualization.DataTable();
      historicalData.addColumn("number", "Hour");
      historicalData.addColumn("number", "Available Bikes");
      historicalData.addRows( {{ historical_data_day }} );

       var historicalOptions = {
          title: 'Historical Occupancy',
          curveType: 'function',
          legend: { position: 'bottom' }
        };
        var historicalChart = new google.visualization.LineChart(document.getElementById('historical_chart'));
        historicalChart.draw(historicalData, historicalOptions);
    }

     function drawHistoricalWeekChart() {
      var historicalData = new google.visualization.DataTable();
      historicalData.addColumn("number", "Day");
      historicalData.addColumn("number", "Available Bikes");
      historicalData.addRows( {{ historical_data_week }} );

       var historicalOptions = {
          title: 'Weekly Occupancy',
          curveType: 'function',
          legend: { position: 'bottom' }
        };

        var historicalChart = new google.visualization.LineChart(document.getElementById('historical_chart_week'));
        historicalChart.draw(historicalData, historicalOptions);

      }
    </script>


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawVisualization);

      function drawVisualization() {
        // Some raw data (not necessarily accurate)
        var data = google.visualization.arrayToDataTable([
         ['Day', 'Available bikes', 'Available stands'],
         ['Mon',  165,      938],
         ['Tues',  135,      1120],
         ['Wed',  157,      1167],
         ['Thur',  139,      1110],
         ['Fri',  136,      691],
         ['Sat',  139,      1110],
         ['Sun',  136,      691]
      ]);

    var options = {
      title : 'Average daily availability',
      vAxis: {title: 'Available'},
      hAxis: {title: 'Day'},
      seriesType: 'bars',
      series: {2: {type: 'line'}}
    };

    var chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
    chart.draw(data, options);
  }
    </script>

  </head>
</head>
<body>
<div id="chart_div" style="width: 900px; height: 500px;"></div>
 {% if name_of_place %}
        <h1> <span id="name_of_stands"> {{ name_of_place[1] }} </span> </h1>
    {% else %}
        <h1> Invalid place </h1>
    {% endif %}
    <a href="/"> home </a>
    <table>
        <tr>
            <td><img src='static/images/green_bike.png' class="legend_image"></td>
            <td>More than 5 available bikes</td>
        </tr>
        <tr>
            <td><img src='static/images/orange_bike.png' class="legend_image"></td>
            <td>Less than 5 bikes available</td>
        </tr>
        <tr>
            <td><img src='static/images/red_bike.png' class="legend_image"></td>
            <td>No available bikes</td>
        </tr>
    </table>
    <div id="home_map"></div>
    <div id="closest_neighbours">
        <p> Closest stand from <span id="name_of_stands"> {{ name_of_place[1] }} </span> </p>
        <a href="/location?location2={{ neighbours[0][0] }}"> <span id="name_of_stands"> 1 - {{ neighbours[0][1] }} </span></a><br>
        <a href="/location?location2={{ neighbours[1][0] }}"> <span id="name_of_stands"> 2 - {{ neighbours[1][1] }} </span></a><br>
        <a href="/location?location2={{ neighbours[2][0] }}"> <span id="name_of_stands"> 3 - {{ neighbours[2][1] }} </span></a>
    </div>


    <table id="station_table">
         <tr>
            <td>Credit Card Facility</td>
            <td>{{ all_data[0] }}</td>
         </tr>
         <tr>
            <td>Total Stands</td>
            <td>{{ all_data[4] }}</td>
         </tr>
         <tr>
            <td>Stands Available</td>
            <td>{{ all_data[5] }}</td>
         </tr>
        <tr>
            <td>Bikes Available</td>
            <td>{{ all_data[6] }}</td>
        </tr>
    </table>
    <div id="current_chart"></div>
    <div id="char_2">
        <button onclick="show_weekly()">Week</button><button onclick = show_daily()>Day</button>
        <div id="historical_chart"></div>
        <div id="historical_chart_week"></div>
    </div>



    <script>
        function googleMap(){
            var canvas= document.getElementById("home_map");
            var myCenter= new google.maps.LatLng({{ name_of_place[2] }},{{ name_of_place[3] }});
            var options= {center: myCenter, zoom:16};
            var map= new google.maps.Map(canvas,options);

            if ({{ all_data[6] }}== 0){
                markerColour = "red";
            } else if ({{ all_data[6] }}< 5) {
                markerColour = "orange";
            } else {
                markerColour = "green";
            }
            var marker = new google.maps.Marker({
                    position: myCenter
            });
            var image = {
                url: 'static/images/' + markerColour + '_bike.png',
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(17, 34),
                scaledSize: new google.maps.Size(65, 65)
            };
            marker.setIcon(image);
            marker.setMap(map);
        }
        function show_weekly(){
            document.getElementById("historical_chart").style.display = 'none';
            document.getElementById("historical_chart_week").style.display = 'block';
        }
        function show_daily(){
            document.getElementById("historical_chart").style.display = 'block';
            document.getElementById("historical_chart_week").style.display = 'incline';
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAN7EfuGN0aiw97d-KPFwWCBDF6GJjRDDM&callback=googleMap"></script>

</body>
</html>
